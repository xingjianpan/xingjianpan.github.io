<!DOCTYPE html>
<html lang="en">
<head>
        <title>Xingjian Pan's Blog - xingjian</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
        <link href="/" type="application/atom+xml" rel="alternate" title="Xingjian Pan's Blog ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body>
	<div id="wrap" style="width:850px">
	    <div id="container" style="width:560px">


            <div class="entry">
        
        

            <header>
            <h1><a href="" id="site-title">   <strong>Learning Data with Python</strong></a>  <a href="/how-to-fix-value-error-embedded-null-byte-error.html" id="page-title">How to fix Python error: ValueError: embedded null byte</a></h1>
<time datetime="2017-01-04T16:25:00+08:00">周三 04 一月 2017</time>            </header>

            <article>
                <p>今天安装了<a href="https://github.com/getpelican/pelican">Pelican</a>，但在运行<code>pelican content</code>时遇到一个非常奇怪的错误。</p>
<div class="highlight"><pre><span></span>  File <span class="s2">&quot;c:\users\...\workingon\pelican\pelican\utils.py&quot;</span>, line 111, in strftime
    <span class="k">return</span> super<span class="o">(</span>SafeDatetime, self<span class="o">)</span>.strftime<span class="o">(</span>fmt<span class="o">)</span>
ValueError: embedded null byte
</pre></div>


<p>根据这个<a href="https://bugs.python.org/issue25023">bug report</a>,这个问题是由于local设定不对导致的。</p>
<h3>在Python中执行下面代码，如果报错，那么说明locale设置有问题</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">locale</span><span class="o">,</span> <span class="nn">time</span>
<span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%a&#39;</span><span class="p">)</span>
</pre></div>


<h3>解决方案</h3>
<p>出错的地方是<code>utils.py</code>,在<code>strftime function</code>是加入如下语句即可解决问题。</p>
<div class="highlight"><pre><span></span><span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">)</span>
</pre></div>


<p>加入后：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">strftime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date_format</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Replacement for built-in strftime</span>

<span class="sd">    This is necessary because of the way Py2 handles date format strings.</span>
<span class="sd">    Specifically, Py2 strftime takes a bytestring. In the case of text output</span>
<span class="sd">    (e.g. %b, %a, etc), the output is encoded with an encoding defined by</span>
<span class="sd">    locale.LC_TIME. Things get messy if the formatting string has chars that</span>
<span class="sd">    are not valid in LC_TIME defined encoding.</span>

<span class="sd">    This works by &#39;grabbing&#39; possible format strings (those starting with %),</span>
<span class="sd">    formatting them with the date, (if necessary) decoding the output and</span>
<span class="sd">    replacing formatted output back.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">strip_zeros</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span>
    <span class="n">c89_directives</span> <span class="o">=</span> <span class="s1">&#39;aAbBcdfHIjmMpSUwWxXyYzZ%&#39;</span>
</pre></div>


<p>另外这个问题也在使用<code>matplotlib</code>时出现过，同样可以通过类似的方法解决。</p>            </article>
                <section id="article-list">
                    <h2>All posts</h2>
                    <ol>
        

 
            <li><a href="/test-for-pelican.html" rel="bookmark" title="Permalink to test for pelican">test for pelican</a></li>
        

 
            <li><a href="/test-for-pelican2.html" rel="bookmark" title="Permalink to test for pelican">test for pelican</a></li>
    </ol>
    </section><!-- #article-list -->
            </div>
        </div>


        <div id="sidebar">
            <h1><a href=" " title="title">Xingjian Pan's Blog</a></h1>
            <span class="description"> </span>
            <!-- <span class="feed"><a href="">RSS</a> | <a href="">Atom</a></span> -->
        </div>

        <div id="footer">
            <nav>
                <ul>
                    <li>:: <a href="/categories.html">Categories</a></li>
                    <li>:: <a href="/tags.html">Tags</a></li>
                </ul>
            </nav>

            <div id="credits">
                <span>Adapted from <a href="http://wordpress.org/themes/monospace">Monospace</a> || Created with <a href="">Pelican</a></span>
            </div>
                
        </div>


    </div>

</body>
</html>