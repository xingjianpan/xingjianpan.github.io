<!DOCTYPE html>
<html lang="en">
<head>
        <title>Xingjian Pan's Blog</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
        <link href="/" type="application/atom+xml" rel="alternate" title="Xingjian Pan's Blog ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body>
	<div id="wrap" style="width:850px">
	    <div id="container" style="width:560px">


            <div class="entry">
        
        

            <header>
            <h1><a href="" id="site-title">   <strong>Learning Data with Python</strong></a>  <a href="/how-to-fix-value-error-embedded-null-byte-error.html" id="page-title">How to fix Python error: ValueError: embedded null byte</a></h1>
<time datetime="2017-01-04T16:25:00+08:00">周三 04 一月 2017</time>            </header>

            <article>
                <p>今天安装了<a href="https://github.com/getpelican/pelican">Pelican</a>，但在运行<code>pelican content</code>时遇到一个非常奇怪的错误。</p>
<div class="highlight"><pre><span></span>  File <span class="s2">&quot;c:\users\...\workingon\pelican\pelican\utils.py&quot;</span>, line 111, in strftime
    <span class="k">return</span> super<span class="o">(</span>SafeDatetime, self<span class="o">)</span>.strftime<span class="o">(</span>fmt<span class="o">)</span>
ValueError: embedded null byte
</pre></div>


<p>根据这个<a href="https://bugs.python.org/issue25023">bug report</a>,这个问题是由于local设定不对导致的。</p>
<h3>在Python中执行下面代码，如果报错，那么说明locale设置有问题</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">locale</span><span class="o">,</span> <span class="nn">time</span>
<span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%a&#39;</span><span class="p">)</span>
</pre></div>


<h3>解决方案</h3>
<p>出错的地方是<code>utils.py</code>,在<code>strftime function</code>是加入如下语句即可解决问题。</p>
<div class="highlight"><pre><span></span><span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">)</span>
</pre></div>


<p>加入后：</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">strftime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date_format</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Replacement for built-in strftime</span>

<span class="sd">    This is necessary because of the way Py2 handles date format strings.</span>
<span class="sd">    Specifically, Py2 strftime takes a bytestring. In the case of text output</span>
<span class="sd">    (e.g. %b, %a, etc), the output is encoded with an encoding defined by</span>
<span class="sd">    locale.LC_TIME. Things get messy if the formatting string has chars that</span>
<span class="sd">    are not valid in LC_TIME defined encoding.</span>

<span class="sd">    This works by &#39;grabbing&#39; possible format strings (those starting with %),</span>
<span class="sd">    formatting them with the date, (if necessary) decoding the output and</span>
<span class="sd">    replacing formatted output back.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;en&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">strip_zeros</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;0&#39;</span>
    <span class="n">c89_directives</span> <span class="o">=</span> <span class="s1">&#39;aAbBcdfHIjmMpSUwWxXyYzZ%&#39;</span>
</pre></div>


<p>另外这个问题也在使用<code>matplotlib</code>时出现过，同样可以通过类似的方法解决。</p>            </article>
                <section id="article-list">
                    <h2>All posts</h2>
                    <ol>
        

 
            <li><a href="/2017-1-4-links.html" rel="bookmark" title="Permalink to Reading List">Reading List</a></li>
        

 
            <li><a href="/test-for-pelican.html" rel="bookmark" title="Permalink to test for pelican">test for pelican</a></li>
        

 
            <li><a href="/test-for-pelican2.html" rel="bookmark" title="Permalink to test for pelican">test for pelican</a></li>
        

 
            <li><a href="/2015-7-31-links.html" rel="bookmark" title="Permalink to Reading List">Reading List</a></li>
        

 
            <li><a href="/2015-7-29-links.html" rel="bookmark" title="Permalink to Reading List">Reading List</a></li>
        

 
            <li><a href="/2015-7-28-links.html" rel="bookmark" title="Permalink to Reading List">Reading List</a></li>
        

 
            <li><a href="/2015-7-27-links.html" rel="bookmark" title="Permalink to Reading List">Reading List</a></li>
        

 
            <li><a href="/i-do-it-because-i-can.html" rel="bookmark" title="Permalink to I do it because I can">I do it because I can</a></li>
        

 
            <li><a href="/the-frence-startups-ecosystem-at-a-tipping-point-chinese.html" rel="bookmark" title="Permalink to (译文)法国初创公司生态系统：处在引爆点上">(译文)法国初创公司生态系统：处在引爆点上</a></li>
        

 
            <li><a href="/smart-people-should-create-things-chinese.html" rel="bookmark" title="Permalink to (译文)有能力的人，应当创造">(译文)有能力的人，应当创造</a></li>
        

 
            <li><a href="/never-complain-never-explain.html" rel="bookmark" title="Permalink to Never complain, never explain.">Never complain, never explain.</a></li>
        

 
            <li><a href="/state-of-big-date-in-2014-a-chart-chinese.html" rel="bookmark" title="Permalink to (译文)大数据行业信息图以及一些思考">(译文)大数据行业信息图以及一些思考</a></li>
        

 
            <li><a href="/notes-on-running-lean.html" rel="bookmark" title="Permalink to Notes on Running Lean (精益创业实践)">Notes on Running Lean (精益创业实践)</a></li>
        

 
            <li><a href="/chan-ye-lian-shu-ju-ke-neng-shi-jin-rong-shu-ju-de-xia-yi-ge-qian-yan.html" rel="bookmark" title="Permalink to 产业链数据可能是金融数据的下一个前沿">产业链数据可能是金融数据的下一个前沿</a></li>
        

 
            <li><a href="/yi-wen-tui-dao-peng-bo-jin-rong-zhong-duan-ji.html" rel="bookmark" title="Permalink to (译文)推倒彭博金融终端机？">(译文)推倒彭博金融终端机？</a></li>
        

 
            <li><a href="/cross-culture-communcation.html" rel="bookmark" title="Permalink to 跨文化管理，即使对于成熟的大公司也是难题。">跨文化管理，即使对于成熟的大公司也是难题。</a></li>
        

 
            <li><a href="/be-aware-of-broken-career-ladder.html" rel="bookmark" title="Permalink to 有些职业梯子（Career Ladder）看起来在那，其实并不在那">有些职业梯子（Career Ladder）看起来在那，其实并不在那</a></li>
        

 
            <li><a href="/notes-on-project-management-lite.html" rel="bookmark" title="Permalink to Note on Project Management Lite">Note on Project Management Lite</a></li>
        

 
            <li><a href="/how-to-install-pymssql-on-macosx-mountain-lion.html" rel="bookmark" title="Permalink to How to install pymssql on Mac OS X Mountain Lion?">How to install pymssql on Mac OS X Mountain Lion?</a></li>
        

 
            <li><a href="/notes-on-the-power-of-habits.html" rel="bookmark" title="Permalink to Note on the power of habits">Note on the power of habits</a></li>
    </ol>
    </section><!-- #article-list -->
            </div>
        </div>


        <div id="sidebar">
            <h1><a href=" " title="title">Xingjian Pan's Blog</a></h1>
            <span class="description"> </span>
            <!-- <span class="feed"><a href="">RSS</a> | <a href="">Atom</a></span> -->
        </div>

        <div id="footer">
            <nav>
                <ul>
                    <li>:: <a href="/categories.html">Categories</a></li>
                    <li>:: <a href="/tags.html">Tags</a></li>
                </ul>
            </nav>

            <div id="credits">
                <span>Adapted from <a href="http://wordpress.org/themes/monospace">Monospace</a> || Created with <a href="">Pelican</a></span>
            </div>
                
        </div>


    </div>

</body>
</html>